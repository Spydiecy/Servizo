<!-- Contact Page -->
<section class="contact-hero py-5 bg-primary text-white">
    <div class="container text-center">
        <h1 class="display-4 mb-3">Contact Us</h1>
        <p class="lead">We'd love to hear from you. Get in touch with us!</p>
    </div>
</section>

<!-- Contact Information Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card text-center h-100 shadow-sm">
                    <div class="card-body">
                        <i class="fas fa-phone fa-3x text-primary mb-3"></i>
                        <h5 class="card-title">Phone</h5>
                        <p class="card-text text-muted">Mon-Fri from 8am to 5pm</p>
                        <a href="tel:+15551234567" class="btn btn-outline-primary">
                            +1 (555) 123-4567
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card text-center h-100 shadow-sm">
                    <div class="card-body">
                        <i class="fas fa-envelope fa-3x text-primary mb-3"></i>
                        <h5 class="card-title">Email</h5>
                        <p class="card-text text-muted">We'll respond within 24 hours</p>
                        <a href="mailto:support@servizo.com" class="btn btn-outline-primary">
                            support@servizo.com
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card text-center h-100 shadow-sm">
                    <div class="card-body">
                        <i class="fas fa-comments fa-3x text-primary mb-3"></i>
                        <h5 class="card-title">Live Chat</h5>
                        <p class="card-text text-muted">Chat with us in real-time</p>
                        <button class="btn btn-primary" onclick="openChatModal()">
                            <i class="fas fa-comment-dots me-2"></i>
                            Start Chat
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact Form Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <h2 class="text-center mb-4">Send Us a Message</h2>
                <form>
                    <div class="mb-3">
                        <label for="contactName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="contactName" required>
                    </div>
                    <div class="mb-3">
                        <label for="contactEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="contactEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="contactSubject" class="form-label">Subject</label>
                        <input type="text" class="form-control" id="contactSubject" required>
                    </div>
                    <div class="mb-3">
                        <label for="contactMessage" class="form-label">Message</label>
                        <textarea class="form-control" id="contactMessage" rows="5" required></textarea>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg">Send Message</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- Live Chat Modal -->
<div class="modal fade" id="chatModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-comments me-2"></i>Live Chat Support
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div id="nameInputSection" class="p-4">
                    <h6 class="mb-3">Please enter your name to start chatting</h6>
                    <div class="input-group">
                        <input 
                            type="text" 
                            class="form-control" 
                            id="chatUserName" 
                            placeholder="Your name"
                            maxlength="50"
                        >
                        <button class="btn btn-primary" onclick="joinChat()">
                            Join Chat
                        </button>
                    </div>
                </div>
                <div id="chatSection" style="display: none;">
                    <div class="p-3 bg-light border-bottom">
                        <small class="text-muted">
                            <span class="status-indicator online"></span>
                            <span id="chatOnlineUsers">Connected</span>
                        </small>
                    </div>
                    <div id="chatMessagesContainer" style="height: 400px; overflow-y: auto; padding: 1rem;"></div>
                    <div id="chatTypingIndicator" class="px-3 py-2 text-muted small" style="display: none;">
                        <em>Someone is typing...</em>
                    </div>
                    <div class="p-3 border-top">
                        <div class="input-group">
                            <input 
                                type="text" 
                                class="form-control" 
                                id="chatMessageInput" 
                                placeholder="Type your message..."
                                maxlength="500"
                            >
                            <button class="btn btn-primary" onclick="sendChatMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.status-indicator {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 5px;
}

.status-indicator.online {
    background-color: #28a745;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.chat-message {
    margin-bottom: 1rem;
    padding: 0.5rem 1rem;
    border-radius: 1rem;
    max-width: 70%;
}

.chat-message.user {
    background-color: #007bff;
    color: white;
    margin-left: auto;
    text-align: right;
}

.chat-message.other {
    background-color: #e9ecef;
    color: #333;
}

.chat-message.system {
    background-color: #fff3cd;
    color: #856404;
    text-align: center;
    max-width: 100%;
    font-size: 0.875rem;
}
</style>

<script src="/socket.io/socket.io.js"></script>
<script>
var socket;
var currentChatUser = null;
var chatModal;

document.addEventListener('DOMContentLoaded', function() {
    chatModal = new bootstrap.Modal(document.getElementById('chatModal'));
});

function openChatModal() {
    chatModal.show();
    document.getElementById('chatUserName').focus();
}

function joinChat() {
    var userName = document.getElementById('chatUserName').value.trim();
    if (!userName) {
        alert('Please enter your name');
        return;
    }

    currentChatUser = {
        name: userName,
        userId: '<%= user ? user._id : "guest" %>'
    };

    if (!socket) {
        socket = io();
        setupSocketListeners();
    }

    socket.emit('user_join', currentChatUser);
    document.getElementById('nameInputSection').style.display = 'none';
    document.getElementById('chatSection').style.display = 'block';
    document.getElementById('chatMessageInput').focus();
    addSystemMessage('Welcome ' + userName + '! You are now connected.');
}

function setupSocketListeners() {
    socket.on('user_joined', function(data) {
        addSystemMessage(data.userName + ' joined the chat');
    });

    socket.on('user_left', function(data) {
        addSystemMessage(data.userName + ' left the chat');
    });

    socket.on('new_message', function(data) {
        var isCurrentUser = data.userId === socket.id;
        addMessage(data.userName, data.message, isCurrentUser);
    });

    socket.on('user_typing', function(data) {
        if (data.userId !== socket.id) {
            document.getElementById('chatTypingIndicator').style.display = 'block';
            setTimeout(function() {
                document.getElementById('chatTypingIndicator').style.display = 'none';
            }, 3000);
        }
    });

    socket.on('user_list', function(users) {
        document.getElementById('chatOnlineUsers').textContent = users.length + ' online';
    });
}

function sendChatMessage() {
    var input = document.getElementById('chatMessageInput');
    var message = input.value.trim();
    
    if (!message) return;

    socket.emit('chat_message', {
        userName: currentChatUser.name,
        message: message,
        userId: currentChatUser.userId
    });

    input.value = '';
}

document.addEventListener('DOMContentLoaded', function() {
    var chatInput = document.getElementById('chatMessageInput');
    if (chatInput) {
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        var typingTimeout;
        chatInput.addEventListener('input', function() {
            if (socket && currentChatUser) {
                socket.emit('typing', currentChatUser);
                clearTimeout(typingTimeout);
                typingTimeout = setTimeout(function() {}, 3000);
            }
        });
    }

    var nameInput = document.getElementById('chatUserName');
    if (nameInput) {
        nameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                joinChat();
            }
        });
    }
});

function addMessage(userName, message, isCurrentUser) {
    var container = document.getElementById('chatMessagesContainer');
    var messageDiv = document.createElement('div');
    messageDiv.className = 'chat-message ' + (isCurrentUser ? 'user' : 'other');
    messageDiv.innerHTML = '<strong>' + userName + '</strong><br>' +
        escapeHtml(message) +
        '<br><small class="text-muted">' + new Date().toLocaleTimeString() + '</small>';
    container.appendChild(messageDiv);
    container.scrollTop = container.scrollHeight;
}

function addSystemMessage(message) {
    var container = document.getElementById('chatMessagesContainer');
    var messageDiv = document.createElement('div');
    messageDiv.className = 'chat-message system';
    messageDiv.innerHTML = '<em>' + escapeHtml(message) + '</em>';
    container.appendChild(messageDiv);
    container.scrollTop = container.scrollHeight;
}

function escapeHtml(text) {
    var div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

document.getElementById('chatModal').addEventListener('hidden.bs.modal', function() {
    if (socket) {
        socket.disconnect();
        socket = null;
    }
    currentChatUser = null;
    document.getElementById('nameInputSection').style.display = 'block';
    document.getElementById('chatSection').style.display = 'none';
    document.getElementById('chatUserName').value = '';
    document.getElementById('chatMessageInput').value = '';
    document.getElementById('chatMessagesContainer').innerHTML = '';
});
</script>
